let functions,admin,cors,express;_8db‍.x([["default",()=>_8db‍.o]]);_8db‍.w("firebase-functions",[["*",null,function(v){functions=v}]]);_8db‍.w("firebase-admin",[["default",["admin"],function(v){admin=v}]]);_8db‍.w("cors",[["default",["cors"],function(v){cors=v}]]);_8db‍.w("express",[["default",["express"],function(v){express=v}]]);




let whitelist = [
  'http://localhost:3000',
  'https://react-most-wanted.com',
  'https://www.react-most-wanted.com',
]

const corsOptions = {
  origin: true,
  optionsSuccessStatus: 200,
}

const app = express()
app.use(cors(corsOptions))
app.all('*', async (req, res) => {
  _8db‍.g.console.log('API call', req)
  _8db‍.g.console.log('API call body', req.body)
  _8db‍.g.console.log('API call method', req.method)
  _8db‍.g.console.log('API call query', req.query)

  if (req.method !== 'GET') {
    res.status(403).send('Forbidden!')
  }

  const { limit = 10 } = req.query

  if (limit > 20) {
    res.status(403).send('Forbidden! Limit ca´t be higher than 20')
  }

  const users = []

  const userSnap = await admin
    .database()
    .ref(`users`)
    .orderByKey()
    .limitToLast(parseInt(limit))
    .once('value')

  if (userSnap.exists()) {
    userSnap.forEach(snap => {
      users.push({
        uid: snap.key,
        displayName: snap.child('displayName').val(),
        photoURL: snap.child('photoURL').val(),
      })
    })
  }

  res.set('Content-Type', 'application/json')

  res.status(200).send({ users })
})

_8db‍.d(functions.https.onRequest(app));
